<!--&lt;!&ndash;<p>friends works!</p>&ndash;&gt;-->
<!--<h2>Friends Page</h2>-->

<!--<div class="search-bar">-->
<!--  <form (ngSubmit)="findUser()">-->
<!--    <input type="search" class="form-control" [(ngModel)]="friendToSearch" name="friend" placeholder="Search by username..." />-->
<!--    <button>Search</button>-->
<!--  </form>-->
<!--</div>-->

<!--<div *ngIf="result">-->
<!--  <strong> Username: {{result.username}}</strong>-->
<!--  &lt;!&ndash; Later: Add Friend / Requested / ✓ Friend &ndash;&gt;-->
<!--  <button (click)="sendRequest(result.id)">Add Friend</button>-->
<!--</div>-->
<!--<p *ngIf="error">{{ error }}</p>-->

<h2>Friends</h2>

<button class="add-friend-btn" (click)="toggleFinder()" aria-label="Find friends">
  <img src="/add-user.png" alt="" class="logo" />
  <span class="label">Find friends</span>
</button>


<!-- Back-drop (clicking it closes the popup) -->
<div class="overlay" *ngIf="showFinder" (click)="toggleFinder()">

<!-- Popup card in the top-right -->
  <div class="popup" *ngIf="showFinder" (click)="$event.stopPropagation()">
    <div class="find-friends-container">

      <h3>Find Friends</h3>

      <div class="search-bar">
        <form (ngSubmit)="findUser()">
          <input type="search" class="form-control" [(ngModel)]="friendToSearch" name="friend" placeholder="Enter username…">
          <button>Search</button>
        </form>
      </div>

      <div *ngIf="searchResult" class="search-res">
        <span>{{ searchResult.username }}</span>
        <button (click)="sendRequest(searchResult.id)"
                [disabled]="pendingAdd">
          {{ pendingAdd ? 'Pending…' : 'Add Friend' }}
        </button>
      </div>

      <p *ngIf="error">{{ error }}</p>
    </div>
  </div>
</div>

<!-- ────────────── Incoming requests ────────────── -->
<h3>Incoming requests</h3>
<ul *ngIf="incoming.length; else noReq">
  <li *ngFor="let r of incoming" class="flex gap-2 items-center mb-1">
    {{ r.senderUsername }}
    <button (click)="actOnRequest(r,'accept')"
            [disabled]="busyIds.has(r.requestId)">Accept</button>
    <button (click)="actOnRequest(r,'decline')"
            [disabled]="busyIds.has(r.requestId)">Decline</button>
  </li>
</ul>
<ng-template #noReq>
  <p class="italic text-gray-500">No pending requests</p>
</ng-template>

<!-- ────────────── Friends list ────────────── -->
<h3 class="mt-6">Your friends</h3>
<ul *ngIf="friends.length; else noFriends">
  <li *ngFor="let f of friends" class="flex gap-2 items-center mb-1">
    {{ f.username }}
    <button (click)="removeFriend(f.id)"
            [disabled]="busyIds.has(f.id)">Remove</button>
  </li>
</ul>
<ng-template #noFriends>
  <p class="italic text-gray-500">You don’t have friends yet. Press the top right icon find your friends!</p>
</ng-template>
